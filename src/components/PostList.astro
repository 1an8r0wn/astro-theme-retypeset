---
import PostDate from '@/components/PostDate.astro'
import { defaultLocale } from '@/config'

interface Post {
  data: {
    title: string
    abbrlink?: string
    published: Date
  }
  // URL path automatically generated by Astro based on the filename
  slug?: string
  // Optional for robustness in case render() fails or plugin isn't applied
  remarkPluginFrontmatter?: {
    minutes?: number
  }
}

const { posts, lang } = Astro.props

export interface Props {
  posts: Post[]
  lang?: string
}

function getPostPath(post: Post) {
  // Prioritize abbrlink over slug
  const postPath = post.data.abbrlink || post.slug
  // Add language prefix to URL if current page is in a language subdirectory and not the default language
  return lang && lang !== defaultLocale ? `/${lang}/posts/${postPath}/` : `/posts/${postPath}/`
}
---
<ul>
  {posts.map(post => (
    <li class="mt-4.375">

      {/* post title */}
      <a
        class="hover:c-primary"
        href={getPostPath(post)}
        transition:name={`post-${post.data.abbrlink || post.slug}-${lang}`}
        data-disable-transition-on-theme
      >
        {post.data.title}
      </a>

      {/* mobile post time */}
      <div
        class="uno-mobile-time"
        transition:name={`time-${post.data.abbrlink || post.slug}-${lang}`}
        data-disable-transition-on-theme
      >
        <PostDate
          date={post.data.published}
          minutes={post.remarkPluginFrontmatter?.minutes}
        />
      </div>

      {/* desktop post time */}
      <div
        class="uno-desktop-time"
        transition:name={`time-${post.data.abbrlink || post.slug}`}
        data-disable-transition-on-theme
      >
        <PostDate
          date={post.data.published}
          minutes={post.remarkPluginFrontmatter?.minutes}
        />
      </div>

    </li>
  ))}
</ul>
