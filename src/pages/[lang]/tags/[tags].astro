---
import { themeConfig } from '@/config'
import Layout from '@/layouts/Layout.astro'
import { getAllTags, getPostsByTag } from '@/utils/content.config'

export async function getStaticPaths() {
  const tags = await getAllTags()
  return themeConfig.global.moreLocale.flatMap(lang =>
    tags.map(tag => ({
      params: { lang, tags: tag },
      props: { tags: tag },
    })),
  )
}

const { lang } = Astro.params
const { tags } = Astro.props
const posts = await getPostsByTag(tags)
const allTags = await getAllTags()
---

<Layout>
  <div>
    {allTags.map(tag => (
      <a href={`/${lang}/tags/${tag}/`}>
        {tag}
      </a>
    ))}
  </div>

  <div>
    <ul>
      {posts.map(post => (
        <li>
          <a href={`/${lang}/posts/${post.slug}/`}>{post.data.title}</a>
        </li>
      ))}
    </ul>
  </div>
</Layout>
