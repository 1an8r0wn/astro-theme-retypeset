---
import Layout from '@/layouts/Layout.astro'
import { getPinnedPosts, getPosts } from '@/utils/content'
import { generateLanguagePaths } from '@/utils/i18n'

export function getStaticPaths() {
  return generateLanguagePaths()
}

const { lang } = Astro.params
const pinnedPosts = await getPinnedPosts()
const posts = await getPosts()
---

<Layout>
  <main>
    {pinnedPosts.length > 0 && (
      <section>
        <ul>
          {pinnedPosts.map(post => (
            <li>
              <a href={`/${lang}/posts/${post.data.slug || post.slug}/`}>
                {post.data.title}
                <time>({post.data.published.toISOString().split('T')[0]})</time>
              </a>
            </li>
          ))}
        </ul>
      </section>
    )}

    <section>
      <ul>
        {posts.map(post => (
          <li>
            <a href={`/${lang}/posts/${post.data.slug || post.slug}/`}>
              {post.data.title}
              <time>({post.data.published.toISOString().split('T')[0]})</time>
            </a>
          </li>
        ))}
      </ul>
    </section>
  </main>
</Layout>
